<!DOCTYPE html>
    <html><head>
    <meta charset='utf-8'>

    <script src='sl.mapapi2.js'></script>
    <link rel='stylesheet' type='text/css' href='sl.mapapi2.css'>

<script>
    function loadmap() {

		const list routeList = [];
		const list waypointsList = [];

        // 1. Retrieve data from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const coordFromUrl = urlParams.get('c');
        const routeListFromUrl = urlParams.get('rL');
        const waypointListFromUrl = urlParams.get('wL');

        // 2. get HTML elements to refer
        const x = document.getElementById('x');
        const y = document.getElementById('y');
        const rLSelect = document.getElementById('rLSelect');
        const wpLSelect = document.getElementById('wpLSelect');

        // 3. Set the value of the input fields
        if(coordFromUrl) {
            const coordinate = coordFromUrl.split('X');
            if (x && coordinate[0]) {
                x.value = coordinate[0]; 
            }
            if (y && coordinate[1]) {
                y.value = coordinate[1]; 
            }
        }

		//let rLText = routeListFromUrl;
        if(routeListFromUrl) {
            const route = routeListFromUrl.split('X');
            route.forEach(coords => {
                const option = document.createElement('option');
				let textCoords = coords.replace("z",",");
                option.textContent = textCoords;
                option.value = coords; 
                rLSelect.appendChild(option);
                
				const coordsArr = coords.split("z");
				routeList += coordsArr[0];
				routeList += coordsArr[1];
                //if(rLText.length > 0) rLText += "X";
                //rLText += coords;
            });
        }

        const rLHiddenInput = document.getElementById("rL")
        rLHiddenInput.value = routeListFromUrl;


        //let wpLText = "";
        if(waypointListFromUrl) {
            const waypoints = waypointListFromUrl.split('X');
            waypoints.forEach(coords => {
                const option = document.createElement('option');
				let textCoord = coords.replace("z",",");
                option.textContent = textCoord;
                option.value = coords; 
                wpLSelect.appendChild(option);

				const coordArr = coords.split("z");
				routeList += coordArr[0];
				routeList += coordArr[1];

                //if(wpLText.length > 0) wpLText += "X";
                //wpLText += coords;
            });
        }

        const wpLHiddenInput = document.getElementById("wL")
        wpLHiddenInput.value = waypointListFromUrl;

        let cText = "";
        if(coordFromUrl) {
            const coord = coordFromUrl.split('X');
            x.value = coord[0];
            y.value = coord[1];
            
            cText += coord[0] +"X"+coord[1];
        }

        const cHiddenInput = document.getElementById("c")
        cHiddenInput.value = cText;


        var lmap = new SLMap(document.getElementById('map-container'));
        var latlng = L.latLng(1000,1000);
        lmap.setView(latlng, 7);
        
        var lmap2 = new SLMap(document.getElementById('map-container2'));
        lmap2.setView(latlng, 2); 
        //lmap2.doubleClickZoom('false');
        
        var region_route = L.polygon([
            [latlng.lat, latlng.lng], 
            [latlng.lat, latlng.lng+1],
            [latlng.lat+1, latlng.lng+1],
            [latlng.lat+1, latlng.lng]
        ], {
            color: 'lightgreen', 
            fillColor: 'lightgreen',
            fillOpacity: 0.5,
        }).addTo(lmap);
        
        var region_route2 = L.polygon([
            [latlng.lat, latlng.lng], 
            [latlng.lat, latlng.lng+1],
            [latlng.lat+1, latlng.lng+1],
            [latlng.lat+1, latlng.lng]
        ], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
        }).addTo(lmap2);
        
        const popup = L.popup()
            .setLatLng([latlng.lat+0.5,latlng.lng+0.5])
            .setContent('Starting point.')
            .openOn(lmap2);
            
        function onMapClick(e) {
            popup
                .setLatLng(e.latlng) 
                .setContent(`You clicked the map at ${e.latlng.toString()}`)
                .openOn(lmap);
            
            //const data = "someValue";
            //window.location.href = `next-page.html?myParam=${data}`;
        }

        lmap.on('click', onMapClick);
    }
    
    function mark_waypoint() {
        //lmap2.dblclick
    }
    
    </script>

    <style>
    div#both {
        marging: 0px;
        padding: 0px;
        background-color: black;
    }
    div#map-container {
        width: 1500px;//492px;   
        height: 1000px;//1016px; 
        //border:4px solid black;
        padding: 8px 8px 8px 16px;
        display: inline-block;
        //background-color: black;
        float: left;
        position: absolute;
         
    }
    div#left-side {
        width: 520px; //492px;
        //height: 500px; 
        //border:4px solid black;
        //padding: 8px 16px 8px 8px;
        display: inline-block;
        float: right;
        background-color: green;
        position: relative;
    }
    div#columns {
        border:4px solid black;
        display: inline-block;
    }
    div#2-columns {
        border:4px solid black;
        display: inline-block;
    }
    div#1-columns {
        border:4px solid black;
        display: inline-block;
        float: left;
    }
    div#map-container2 {
        width: 500px; //492px;
        height: 500px; 
        //border:4px solid black;
        padding: 8px 8px 8px 8px;
        display: inline-block;
        float: right;
        //background-color: black;
        position: relative;
    }
    div#search-box {
        width: 220px; //492px;
        //height: 500px; 
        border:4px solid black;
        padding: 8px 16px 8px 8px;
        display: inline-grid;
        float: right;
        //background-color: black;
        position: relative;
    }
    div#wp_boxes {
        display:list-item;
    }
    div#waypoint-list-box {
        width: 220px; //492px;
        //height: 500px; 
        border:4px solid black;
        padding: 8px 16px 8px 8px;
        display: inline-grid;
        float: right;
        //background-color: black;
        position: relative;
    }
    div#points-list-box {
        width: 220px; //492px;
        //height: 500px; 
        border:4px solid black;
        padding: 8px 16px 8px 8px;
        display: inline-grid;
        float: left;
        //background-color: black;
        position: relative;
    }
    body {
        margin: 0px;
        border:0px;
        background-color: white;// black;
    }
    </style>

    </head><body onload='loadmap()'>
    
    <div id='map-container'></div>
    <div id='left-side'>

        <div id='map-container2'></div>
        
        <div id='columns'>
            <div id='1-columns'>
                <div id='points-list-box'>
                    <label>Route:</label>
                    <select id='rLSelect' name='rLSelect' multiple size='22'>
                    </select>
                    <button type="button"  onclick="alert('Hello World!')">Go!</button> 
                </div>
            </div>
            
            <div id='2-columns'>
                
                <div id='search-box'>
                    <label for='search-label'>Search waypoint by coords:</br></label>
                    <div id='wp_boxes'>
                        
                        <input type='text' id='x' name='x' required style='width:90px' display='inline-flex' />
                        <input type='text' id='y' name='y' required style='width:90px' display='inline-flex' />
                        <form action='' method='GET'>
                        <input type="hidden" id="c" name="c" value="">
                        <input type="hidden" id="rL" name="rL" value="">
                        <input type="hidden" id="wL" name="wL" value="">
                        <input type='submit' value='Go!' display='inline-flex'>
                        </form>
                    </div>
                </div>
                

                <div id='waypoint-list-box'>
                    <label>Waypoints:</label>
                    <select id='wpLSelect' name='wpLSelect' multiple size='17'>
                    </select>
                    <button type="button"  onclick="alert('Hello World!')">Go!</button> 
                    <button type="button" onclick="alert('Hello World!')">Go!</button> 
                </div>
            </div>
        </div>
    </div>
            
    </body></html>